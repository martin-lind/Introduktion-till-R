---
title: "Läsa in data i R"
---

Det första steget, innan man gör en statistisk analys, är alltid att läsa in data i R.

## Dataformat

R kan hantera ett stort antal dataformat, vissa av dem läses automatiskt, andra kräver att man laddar ner och installerar specialiserade paket

+-----------------------------------+--------------------------------+----------------+-------------------+--------------------------------------------------------------------------------------------------+
| Filändelse                        | Beskrivning                    | Funktion       | Extra paket krävs | Kommentarer                                                                                      |
+===================================+================================+================+===================+==================================================================================================+
| `txt`                             | Tab-avgränsad text             | `read.table()` | \-                |                                                                                                  |
+-----------------------------------+--------------------------------+----------------+-------------------+--------------------------------------------------------------------------------------------------+
| `csv`                             | Komma/semikolon-avgränsad text | `read.csv()`   | \-                | Specificera om avgränsningen är "," eller ";"                                                    |
+-----------------------------------+--------------------------------+----------------+-------------------+--------------------------------------------------------------------------------------------------+
| `xlsx`                            | Exceldokument                  | `read.xlsx()`  | `openxlsx`        | [Se paketets dokumentation](https://cran.r-project.org/web/packages/openxlsx/readme/README.html) |
+-----------------------------------+--------------------------------+----------------+-------------------+--------------------------------------------------------------------------------------------------+
| `rda`                             | R-datafil                      | `load()`       |                   |                                                                                                  |
+-----------------------------------+--------------------------------+----------------+-------------------+--------------------------------------------------------------------------------------------------+
| `sas7bdat` `sas7bcat` `dta` `sav` | SAS\                           | `read_sas()`\  | `haven`           | [Se paketets dokumentation](https://haven.tidyverse.org/)                                        |
|                                   | Stata\                         | `read_dta()`\  |                   |                                                                                                  |
|                                   | SPSS                           | `read_sav()`   |                   |                                                                                                  |
+-----------------------------------+--------------------------------+----------------+-------------------+--------------------------------------------------------------------------------------------------+

: Vanliga datatyper som R kan läsa in (många fler alternativ finns)

## Vilket sätt skall en fil läsas in på?

Det finns många sätt att läsa in en fil, det beror dels på om du använder R eller R Studio, men också på om du vill dokumentera vad filen heter och var den är placerad (rekommenderas för reproducerbarhet). Slutligen kan valet bero på om du använder R-projekt eller inte.

## Exempel: Läsa in en `txt` i R med absolut sökväg

I följande exempel läser vi in en tab-avgränsad datafil med filändelsen `txt` i R.

Metoden bygger på att vi vill ha den absoluta sökvägen till vår datafil (dvs var på hårddisken den ligger), det är en bra metod att använda sig av för att alltid veta vilken fil man arbetar med.

**Fördel**

-   Ger en absolut sökväg (du hittar alltid vilken fil du arbetar med)

**Nackdel**

-   Att få reda på den absoluta sökvägen kan vara lite omständigt (men behöver bara göras en gång per dataset)

### Ta reda på den absoluta sökvägen till din fil med data

Ladda ner följande fil [testdata.txt](data/testdata.txt) (högerklicka, välj "spara länk som") och spara filen på din hårddisk.

Nästa steg är att tala om för R var på din hårddisk du har sparat filen (den absoluta sökvägen till filen).

Det enklaste sättet att få reda på den absoluta sökvägen är att öpna din **filhanterare** (finder, utforskaren eller liknande) och leta upp filen. Sedan **drar du filen och släpper den i R-konsolen**. Då kommer du få se dess sökväg, vilket visas i **blått** på en Mac (samt ev felmeddelanden eftersom du gör något som R inte förstår, men R ger dig sökvägen, vilket är vad vi vill ha).

![](images/absolute-path-R.png){fig-align="left" width="600"}

Sökvägen till filen på min dator är: `~/git_projects/Introduktion-till-R/tutorials/read-data/data/testdata.txt`

**R Studio** - om du använder R studio fungerar det inte att dra filen till konsolen. Istället kan du öppna din terminal (Terminal, iTerm, EMAC, MobaXterm etc) och släppa filen där. Eller gör det i vanliga R. Då får du en sökväg.

![Sökväg till filen om man släpper den i en terminal (iTerm i exemplet)](images/absolute-path-terminal.png){fig-align="left" width="600"}

### Läs in filen i R

Vi kommer att läsa in filen med funktionen `read.table()`.

```{r}
testdata <- read.table("data/testdata.txt",
                     header=T,
                     sep="\t",
                     dec=",") 
```

`<-` betyder att vi sparar resultatet av funktionen (just nu `read.table()`) i ett objekt. Eftersom det är vårt data är objektet en **dataframe**. Pilen `<-` pekar på objektet, och vi ger det ett passande namn, i det här fallet `testdata`.

`read.table()` är funktionen för att läsa in textfiler med filändelsen `.txt`

`"data/testdata.txt"` är sökvägen till datafilen, dvs där den är sparad på din hårddisk (`data/`), och namnet på filen (`testdata.txt`).

`header=T` betyder att den första raden i datafilen är en rubrikrad och inte består av data. Det är nästan alltid fallet om du läser in en datafil till R. Om även första raden består av data (dvs det finns inga rubriker) ersätter du `T` med `F` (`T` står för TRUE, `F` står för FALSE).

`sep=T` betyder att alla värden/celler är separerade med TAB (det är en tab-separerad textfil).

`dec=","` betyder att kommatecken används som decimalseparator (ex 1,32). Om filen istället använder punkt som decimalseparator (ex 1.32), anger du istället `dec="."`

## Inspektera ditt data

Nästa steg är att insprektera ditt dataset, för att se om allt gått rätt till vid inläsningen.

Börja med att inspektera datasetets struktur med `str()`.

```{r}
str(testdata)
```

`$ Colour: chr` betyder att värderna i `Colour` kolumnen är *bokstäver* (characters)

`$ Weight: int` betyder att värderna i kolumnen `Weight` är *heltal* (integers)

`$ Length: num` betyder att värderna i kolumnen `Length` är *decimaltal* (numeric)

Om du har en kolumn som borde innehålla decimaltal, skall det stå `num`. Om det istället står `chr` betyder det att datafilen har punkt som decimalavskiljare, men du utgår från att det är komma (eller tvärtom) och därmed tror R att det är text. Ändra avskiljare, ex från `dec=","` till `dec="."` i koden och importera datasetet på nytt.

Sedan visar du de första raderna i ditt dataset med funktionen `head()` och verifierar att allt ser korrekt ut.

```{r}
head(testdata)
```

Om allt ser korrekt ut så är du redo att analysera ditt data!

## Använda relativ sökväg

Den absoluta sökvägen till en fil är ofta lång och ibland omständig att få fram. Ett alternativ är att istället använda relativa sökvägar.

En relativ sökväg är **sökvägen till en fil, relativt den foldern du befinner dig i just nu**.

Platsen du befinner dig just nu är din Working Direcory, och du kan själv bestämma vad som är din Working Directory. Troligtvis har du alla filer som tillhör ett visst projekt i en mapp på din hårddisk, då hade det varit smart att ange den mappen som din Working Directory.

Du kan se var din Working Directory är just nu genom funktionen `getwd()`

Testa att undersöka var din Working Directory är

```{r}
getwd()
```

Du kan därefter skriva in den absoluta sökvägen till din Working Directory genom funktionen `setwd()`

### Använd menyerna

Ett alternativt sätt att ta dig fram till din Working Directory är att använda dig av menyerna.

Använd menyerna för att välja mappen där du sparat filen `testdata.txt` som din nya Working Directory!

I **R** kan du välja Working Directory genom att klicka följande i menyerna:

![](images/R-setwd.png){width="600"}

I **RStudio** finns motsvarande menyval

![](images/RStudio-setwd.png){width="600"}

Det är dock bra att dokumentera din Working Directory i ditt script, så att du inte behöver sätta den manuellt nästa gång du skall arbeta med samma data.

**Efter att du ställt in rätt Working Directory i menyerna, gör följande:**

1.  Ta du reda på den absoluta sökvägen till din Working Directory med `getwd()`

```{r}
getwd()
```

2.  Skriv in den absoluta sökvägen i ditt script, inuti funktionen `setwd()`

```{r}
setwd("/Users/martin/git_projects/Introduktion-till-R")
```

Nästa gång du öppnar R och ditt script så räcker det att köra raden med setwd() där du just fyllt i din sökväg, så hamnar du direkt i din mapp!

### Läs in filen

Nu är din Working Directory samma mapp som filen `testdata.txt` ligger i. När du nu läser in din fil behöver du inte ange dess absoluta sökväg, det räcker att ange dess filnamn!

`testdata <- read.table("testdata.txt", header=T,sep="\t", dec=",")`

Se [Läs in filen i R] för vår tidigare beskrivning av hur man tolkar de olika delarna av funktionen `read.table()`.
